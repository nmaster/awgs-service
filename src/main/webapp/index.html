<html>
<head>

	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/base/jquery-ui.css" type="text/css" media="all" />
	<link rel="stylesheet" href="./css/jquery.tooltip.css" type="text/css" media="all" />
	<style type="text/css">
		* { 
			font-family: Verdana;
			sans-serif; 
		}
		
		body { font: 1em "Trebuchet MS", verdana, arial, sans-serif; font-size: 100%; }
		input, textarea { font-family: Arial; font-size: 125%; padding: 7px; }
		label { display: block; }
		
		.empty {
			width:50px;
		}
		
		.fg-button { 
			outline: 0; 
			width: 350px;
			font-size: 17pt;
			text-decoration:none !important; 
			cursor:pointer; 
			position: relative; 
			text-align: center; 
			zoom: 1; 
    }
   
		#bar {
      top:0;
      right:0;
      left:0;
      font-size: 9pt;
      text-align:right;
      vertical-align:middle;
      background:#000;
      
      padding: 4px;
      margin: 0px;
      width:100%;
   }
   
   #loginb, #logoutb {
   	 color: #fff;
   }
   
   #username {
    color:#bbf;
   	font-weight:bold;
   }
		
	</style>
	
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
	<script type="text/javascript" src="./javascript/jquery.base64.js"></script>
	<script type="text/javascript" src="./javascript/jquery.tooltip.js"></script>
	<script type="text/javascript" src="./javascript/awgs.js"></script>
	
	<script type="text/javascript">
		
		var awgs;
		
		function updateUsers() {
			/*
			awgs.getUsers(function(users){
				var ol = $("<ol></ol>").attr({"id":"userlist"});
				for(i in users){
					var usr = users[i];
					var li =  $("<li></li>").append("<span>" + usr.xp + "XP</span> - <span>" + usr.name + "</span>");
					ol.append(li);
				}
				$("#users").html(ol);
			});
			*/
		}
		
		function updateItems() {
			console.log("Items listing request");
			awgs.getItems(function(items){
				var itemt = "<table padding='10' border='0'>";
				itemt += "<tr style='text-align:left; background:#ddd;'><th>Id</th><th>Name</th><th>Owner</th><th>Last Update</th></tr>"
				for(var i=0;i<items.length;i++){
					var item = items[i];
					//console.log("Item " + item.id + " - " + item.name);
					
					itemt += "<tr><td><a href='" + item.resource + "'>" + item.id + "</a></td><td>" + item.name + "</td><td><a href='xmpp:" + item.owner + "' title='" +item.owner + "'>" + item.owner + "</a></td><td>" + item.lastupdate + "</td></tr>";
				}
				itemt += "</table>";
				$("#items").html(itemt);
			});
		}
		
		function updateStatus(){
			if(awgs.authenticated()){
				$("#username").html(awgs.getUser());
				$("#loginb").hide();
				$("#logoutb").show();
				$("#registerb").show();
				
			} else {
				$("#username").html("");
				$("#loginb").show();
				$("#logoutb").hide();
				$("#registerb").hide();
			}
		}
		
		function init() {
			
			awgs = new AwgsClient("http://localhost:8080/awgs-service/resources/");
			
			// load all users and display in a list
			updateStatus();
			updateUsers();
			updateItems();
			
			$( "#loginb").click(function() {
				$("#dialog-login").dialog("open");
			});
			
			$("#dialog-login").dialog({
				autoOpen: false,
				height: 230,
				width: 400,
				modal: true,
				buttons: {
					"Login": function() {
						var that = $(this);
						awgs.authenticate(
							$("#login-login").val(),
							$("#login-password").val(),
							function(result){
								console.log("Login Result: " + result);
								if(result){
									that.dialog("close");
									updateStatus();
								}
							});
					},
					Cancel: function() {
						$(this).dialog("close");
					}
				}
			});
			
			$( "#logoutb" ).click(function() {
				awgs.logout();
				updateStatus();
			});
			
			$( "#registerb" ).button().click(function() {
				$( "#dialog-register" ).dialog("open");
			});
			
			$("#dialog-register").dialog({
				autoOpen: false,
				height: 440,
				width: 400,
				modal: true,
				buttons: {
					"Register": function() {
						var that = $(this);
						
						var item = {
								name: $("#register-name").val(),
							  description: $("#register-description").val(),
							  url: $("#register-url").val(),
							  status: $("#register-status").val()
						}
						awgs.createItem(item,function(result){
							console.log("Created item " + result);
							updateItems();
							that.dialog("close");
						});
					},
					Cancel: function() {
						$(this).dialog("close");
					}
				}
			});
		}
		
		function updateTips( t ) {
			$("#signup-tips").text( t ).addClass( "ui-state-highlight" );
			setTimeout(function() {
				$("#signup-tips").removeClass( "ui-state-highlight", 1500 );
			}, 500 );
		}
		
		function checkLength( o, n, min, max ) {
			if ( o.val().length > max || o.val().length < min ) {
				o.addClass( "ui-state-error" );
				updateTips( "Length of " + n + " must be between " +
					min + " and " + max + "." );
				return false;
			} else {
				return true;
			}
		}

		function checkRegexp( o, regexp, n ) {
			if ( !( regexp.test( o.val() ) ) ) {
				o.addClass( "ui-state-error" );
				updateTips( n );
				return false;
			} else {
				return true;
			}
		}
		
		$(document).ready(init);
		
	</script>
</head>

<body>
<div id="bar">
	<span id="username"></span>
	<span class="empty"></span> 
	<span id="loginb" class="ui-button-text">Login</span>
  <span id="logoutb" class="ui-button-text">Logout</span>
</div>

<div id="main">
<h2>The ACIS Working Group Series</h2>

A service for managing the ACIS Working Group Series, a series of working papers created by members of the ACIS working group at Chair of Computer Science 5 - Databases &amp; Information Systems, RWTH Aachen University, Germany.

<br/><br/>




<div id="profile">
	
	<span id="profile-buttons">
		<button id="registerb" class="fg-button ui-state-default ui-corner-all">Register new AWGS ID</button>
	</span>
</div>

<br/>

<div id="items">
	
</div>

<div id="users"></div>

</div>
<div id="dialog-login" title="Login">
	<form>
		<fieldset>
			<label for="login-login">Login:</label>
			<input type="text" id="login-login" value="" size="50" class="text ui-widget-content ui-corner-all" /><br/>
			<label for="login-password">Pass:</label>
			<input type="password" id="login-password" size="50" value="" class="text ui-widget-content ui-corner-all" /><br/>
		</fieldset>
	</form>
</div>

<div id="dialog-register" title="Register">
	Register a new ACIS Working Group Series Item.
	<form>
		<fieldset>
			<label for="">Name:</label>
			<input type="text" id="register-name" value="" size="50" class="text ui-widget-content ui-corner-all" /><br/>
			<label for="register-description">Description:</label>
			<input type="text" id="register-description" value="" size="50" class="text ui-widget-content ui-corner-all" /><br/>
			<label for="register-url">URL:</label>
			<input type="text" id="register-url" value="" size="50" class="text ui-widget-content ui-corner-all" /><br/>
			<label for="register-status">Status:</label>
			<input type="text" id="register-status" value="" size="50" class="text ui-widget-content ui-corner-all" /><br/>
		</fieldset>
	</form>
</div>

</body>
</html>
